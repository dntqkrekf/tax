# 2018 ëŒ€í•œë¯¼êµ­ ì¢…í•©ì†Œë“ì„¸ ê³„ì‚°ê¸° (ê³¼ì„¸í‘œì¤€ ê¸°ì¤€, ì›)
# ì‘ì„±ì: ë‹¹ì‹ 

import streamlit as st
from dataclasses import dataclass

st.set_page_config(page_title="2018 ì¢…í•©ì†Œë“ì„¸ ê³„ì‚°ê¸°", page_icon="ğŸ’°")

st.title("ğŸ’° 2018 ëŒ€í•œë¯¼êµ­ ì¢…í•©ì†Œë“ì„¸ ê³„ì‚°ê¸°")
st.caption("ê³¼ì„¸í‘œì¤€(ì›) ê¸°ì¤€ Â· êµ¬ê°„ë³„ ëˆ„ì§„ì„¸ìœ¨ í•©ì‚° ê³„ì‚° Â· ì§€ë°©ì†Œë“ì„¸(êµ­ì„¸ì˜ 10%) í¬í•¨ ê°€ëŠ¥")

@dataclass
class TaxBracket:
    limit: int
    rate: float

# 2018 ê³¼ì„¸í‘œì¤€ ê¸°ì¤€ ì„¸ìœ¨í‘œ
BRACKETS_2018 = [
    TaxBracket(12_000_000, 0.06),    # 1,200ë§Œì› ì´í•˜
    TaxBracket(46_000_000, 0.15),    # 4,600ë§Œì› ì´í•˜
    TaxBracket(88_000_000, 0.24),    # 8,800ë§Œì› ì´í•˜
    TaxBracket(150_000_000, 0.35),   # 1ì–µ5ì²œë§Œì› ì´í•˜
    TaxBracket(300_000_000, 0.38),   # 3ì–µì› ì´í•˜
    TaxBracket(500_000_000, 0.40),   # 5ì–µì› ì´í•˜
    TaxBracket(1_000_000_000, 0.42), # 10ì–µì› ì´í•˜
    TaxBracket(None, 0.45),          # 10ì–µì› ì´ˆê³¼
]

def calc_income_tax_kr_2018(taxable_income: int, include_local_tax: bool = True):
    """2018 ê³¼ì„¸í‘œì¤€ ê¸°ì¤€ ëˆ„ì§„ì„¸ìœ¨ ê³„ì‚°"""
    if taxable_income <= 0:
        return 0, 0, 0, []

    remaining = taxable_income
    lower = 0
    national = 0
    details = []

    for b in BRACKETS_2018:
        upper = b.limit if b.limit is not None else taxable_income
        span = (upper - lower) if b.limit is not None else remaining
        taxable_here = max(0, min(remaining, span))
        if taxable_here <= 0:
            break

        tax_here = int(round(taxable_here * b.rate))
        national += tax_here
        details.append({
            "êµ¬ê°„": f"{lower:,} ~ {('âˆ' if b.limit is None else format(upper, ','))} ì›",
            "ì ìš© ì„¸ìœ¨": f"{int(b.rate * 100)}%",
            "í•´ë‹¹ êµ¬ê°„ ê³¼ì„¸í‘œì¤€": f"{taxable_here:,} ì›",
            "êµ¬ê°„ ì„¸ì•¡": f"{tax_here:,} ì›"
        })

        remaining -= taxable_here
        lower = upper
        if remaining <= 0:
            break

    local = int(round(national * 0.10)) if include_local_tax else 0
    total = national + local

    return national, local, total, details

# Streamlit UI
with st.form("input_form"):
    taxable_income = st.number_input("ê³¼ì„¸í‘œì¤€(ì›)ì„ ì…ë ¥í•˜ì„¸ìš”", min_value=0, step=100_000, value=75_000_000, format="%d")
    include_local = st.checkbox("ì§€ë°©ì†Œë“ì„¸(êµ­ì„¸ì˜ 10%) í¬í•¨", value=True)
    submitted = st.form_submit_button("ê³„ì‚°í•˜ê¸°")

if submitted:
    national, local, total, details = calc_income_tax_kr_2018(taxable_income, include_local)
    st.subheader("ğŸ“Š ê³„ì‚° ê²°ê³¼")
    st.metric("êµ­ì„¸(ì†Œë“ì„¸)", f"{national:,} ì›")
    if include_local:
        st.metric("ì§€ë°©ì†Œë“ì„¸ (10%)", f"{local:,} ì›")
    st.metric("ì´ ì„¸ì•¡", f"{total:,} ì›")

    if details:
        st.write("### ğŸ“‹ êµ¬ê°„ë³„ ë‚´ì—­")
        st.dataframe(details, use_container_width=True)

st.divider()
st.caption("â€» ë³¸ ê³„ì‚°ê¸°ëŠ” 2018ë…„ ê·€ì† ì¢…í•©ì†Œë“ì„¸ìœ¨ ê¸°ì¤€ ì˜ˆì‹œì´ë©°, ê³µì œÂ·ê°ë©´Â·ëˆ„ì§„ê³µì œ ë“±ì€ ë°˜ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
